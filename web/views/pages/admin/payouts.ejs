<%- include('../../partials/header', { user }) %>

<%- include('../../partials/admin-nav', { currentPage: 'payouts' }) %>

<div class="bg-zinc-950 text-gray-100 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="mb-6 flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-[#E31E24]">Payout Management</h1>
        <p class="text-gray-400">Review and process payout requests</p>
      </div>
      <div class="flex gap-2">
        <a href="?status=pending" class="px-4 py-2 rounded <%= filter === 'pending' ? 'bg-[#E31E24]' : 'bg-zinc-800' %>">Pending</a>
        <a href="?status=approved" class="px-4 py-2 rounded <%= filter === 'approved' ? 'bg-[#E31E24]' : 'bg-zinc-800' %>">Approved</a>
        <a href="?status=rejected" class="px-4 py-2 rounded <%= filter === 'rejected' ? 'bg-[#E31E24]' : 'bg-zinc-800' %>">Rejected</a>
      </div>
    </div>
    
    <div class="space-y-4">
      <% payouts.forEach(payout => { %>
        <div class="bg-zinc-900 rounded-lg p-6">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="px-3 py-1 rounded text-sm <%= payout.status === 'approved' ? 'bg-[#E31E24]' : payout.status === 'pending' ? 'bg-red-500/30' : 'bg-[#8B0F14]' %>">
                  <%= payout.status %>
                </span>
                <span class="text-2xl font-bold text-[#E31E24]">$<%= payout.amount %></span>
              </div>
              <p class="text-lg font-semibold mb-2">User: <%= payout.username %></p>
              <p class="text-gray-400">Method: <%= payout.payout_method || 'Not specified' %></p>
              <p class="text-xs text-gray-500 mt-2">Requested: <%= new Date(payout.requested_at).toLocaleString() %></p>
              <% if (payout.processed_at) { %>
                <p class="text-xs text-gray-500">Processed: <%= new Date(payout.processed_at).toLocaleString() %></p>
              <% } %>
              <% if (payout.proof_file) { %>
                <a href="<%= payout.proof_file %>" target="_blank" class="text-[#E31E24] hover:text-[#FF4146] text-sm">View Proof</a>
              <% } %>
              <% if (payout.rejection_reason) { %>
                <p class="text-[#E31E24] mt-2 text-sm">Rejection: <%= payout.rejection_reason %></p>
              <% } %>
            </div>
            
            <% if (payout.status === 'pending') { %>
              <div class="flex flex-col gap-2">
                <button onclick="approvePayout(<%= payout.id %>)" class="bg-[#E31E24] hover:bg-[#B91419] px-6 py-2 rounded">Approve</button>
                <button onclick="rejectPayout(<%= payout.id %>)" class="bg-zinc-700 hover:bg-zinc-600 px-6 py-2 rounded">Reject</button>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
      
      <% if (payouts.length === 0) { %>
        <div class="bg-zinc-900 rounded-lg p-8 text-center text-gray-400">
          No <%= filter %> payouts found
        </div>
      <% } %>
    </div>
  </div>
  
  <script>
    async function approvePayout(id) {
      if (!confirm('Approve this payout request?')) return;
      
      const response = await fetch(`/admin/payouts/approve/${id}`, { method: 'POST' });
      const result = await response.json();
      alert(result.message);
      if (result.success) window.location.reload();
    }
    
    async function rejectPayout(id) {
      const reason = prompt('Reason for rejection:');
      if (!reason) return;
      
      const response = await fetch(`/admin/payouts/reject/${id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reason })
      });
      
      const result = await response.json();
      alert(result.message);
      if (result.success) window.location.reload();
    }
  </script>
  </div>
</div>

<%- include('../../partials/footer', { user }) %>
